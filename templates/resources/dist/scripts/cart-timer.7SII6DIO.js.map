{
  "version": 3,
  "sources": ["../../src/scripts/theme/utils/init.js", "../../src/scripts/packs/cart-timer.js"],
  "sourcesContent": ["// This script establishes a MutationObserver to detect changes in the DOM and run callbacks when changes are detected.\n// It tries to be efficient about this by establishing only one obeserver and running all callbacks once on each new node.\n// There is a limitation of this mechanism: if a node contains a script that has not before been added to the dom,\n// and it calls onDomChange, its callback won't be run against anything until the next mutation.\n// To work around this, ensure the script is loaded in the initial page load or a previous fetch.\n\nwindow.StoreConnect = window.StoreConnect || {}\nwindow.StoreConnect.ObserverCallbacks = window.StoreConnect.ObserverCallbacks || []\n\ndocument.addEventListener('DOMContentLoaded', establishObserver)\n\nexport function onDomChange(initCallback) {\n  window.StoreConnect.ObserverCallbacks.push(initCallback)\n}\n\nfunction establishObserver() {\n  if (window.StoreConnect.Observer) return\n\n  window.StoreConnect.Observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      mutation.addedNodes.forEach((node) => {\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          runCallbacks(node, 'mutation')\n        }\n      })\n    })\n  })\n\n  window.StoreConnect.Observer.observe(document.body, { childList: true, subtree: true })\n\n  runCallbacks(document, 'initial load')\n}\n\nfunction runCallbacks(node, _context) {\n  window.StoreConnect.ObserverCallbacks.forEach((callback) => callback(node))\n}\n", "import { onDomChange } from '../theme/utils/init'\n\nonDomChange(init)\n\nconst WARNING_TIMESPAN = 1000 * 60 // 1 min\n\nlet expiry\n\nfunction init(node) {\n  ;[...node.querySelectorAll('[data-sc-cart-timer]')].forEach((timer) => {\n    expiry = timer.getAttribute('data-sc-expiry')\n\n    const timeRemaining = getTimespan(expiry)\n    if (timeRemaining <= 0) return expire()\n    setInterval(() => timer.dispatchEvent(new Event('countdown')), 1000)\n    timer.addEventListener('countdown', countdown)\n  })\n}\n\nfunction countdown() {\n  const timeRemaining = getTimespan(expiry)\n\n  if (timeRemaining <= 0) return expire()\n  if (timeRemaining <= WARNING_TIMESPAN) warn()\n  ;[...document.querySelectorAll('[data-sc-cart-timer]')].map((timer) => {\n    timer.querySelector('[data-sc-mins]').innerText = getMinutes(timeRemaining)\n    timer.querySelector('[data-sc-secs]').innerText = getSeconds(timeRemaining)\n  })\n}\n\nfunction warn() {\n  ;[...document.querySelectorAll('[data-sc-cart-timer]')].map((timer) =>\n    timer.classList.add('warning')\n  )\n}\n\nfunction expire() {\n  document.removeEventListener('countdown', countdown)\n  ;[...document.querySelectorAll('[data-sc-cart-timer]')].map((timer) => {\n    const label = timer.querySelector('[data-sc-label]')\n\n    timer.classList.add('expired')\n    label.innerText = label.dataset.scExpired\n  })\n  ;[...document.querySelectorAll('[data-sc-cart]')].map((cart) => {\n    cart.classList.add('expired')\n    ;[...cart.querySelectorAll('[data-sc-cart-booking]')].map((node) => {\n      node.classList.add('expired')\n    })\n  })\n}\n\nfunction getTimespan(expiryDate) {\n  return Date.parse(expiryDate) - Date.parse(new Date())\n}\n\nfunction getMinutes(time) {\n  return new Date(time).getMinutes()\n}\n\nfunction getSeconds(time) {\n  const secs = new Date(time).getSeconds()\n  return (secs < 10 ? '0' : '') + secs\n}\n"],
  "mappings": "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",
  "names": []
}
