(()=>{var S=[],g=[];function T(c){[...c.querySelectorAll("[data-bundle-filter-option]")].map(n=>{n.addEventListener("click",i=>{Q(i.target),X()})})}function Q(c){let n=c.getAttribute("data-brand"),i=c.getAttribute("data-category");c.checked?(n&&!g.includes(n)&&g.push(n),i&&!S.includes(i)&&S.push(i)):(n&&g.includes(n)&&I(n,g),i&&S.includes(i)&&I(i,S))}function X(){[...document.querySelector("[data-bundle-filterable]").querySelectorAll("[data-product-option-sfid]")].map(n=>{let i=n.getAttribute("data-product-brand-sfid"),f=n.getAttribute("data-category-sfid");S.length===0&&g.length===0||(g.includes(i)||g.length===0)&&(S.includes(f)||S.length===0)?n.classList.remove("is-hidden"):n.classList.add("is-hidden")})}function I(c,n){let i=n.indexOf(c);i>-1&&n.splice(i,1)}function L(c){let n=document.querySelector('meta[name="sc-path"]');if(n){let i=n.content;if(i)return`/${i}${c}`}return c}function b(c,n){let i=n.method?n.method.toUpperCase():"GET";if(i!=="GET"&&i!=="HEAD"){let m=document.querySelector('meta[name="csrf-token"]')?document.querySelector('meta[name="csrf-token"]').getAttribute("content"):"";n.headers={...n.headers,"X-CSRF-Token":m}}return fetch(c,n).then(f=>{if(!f.ok)throw new Error("Network response was not ok: "+f.statusText);let m=f.headers.get("Content-Type");return m.includes("application/json")?f.json():m.includes("text/javascript")?f.text().then(w=>(0,eval)(w)):m.includes("text/html")?f.text():f.blob()})}window.StoreConnect=window.StoreConnect||{};window.StoreConnect.ObserverCallbacks=window.StoreConnect.ObserverCallbacks||[];document.addEventListener("DOMContentLoaded",z);function P(c){window.StoreConnect.ObserverCallbacks.push(c)}function z(){window.StoreConnect.Observer||(window.StoreConnect.Observer=new MutationObserver(c=>{c.forEach(n=>{n.addedNodes.forEach(i=>{i.nodeType===Node.ELEMENT_NODE&&N(i,"mutation")})})}),window.StoreConnect.Observer.observe(document.body,{childList:!0,subtree:!0}),N(document,"initial load"))}function N(c,n){window.StoreConnect.ObserverCallbacks.forEach(i=>i(c))}P(K);function K(c){let n=c.querySelector("[data-bundle]");if(n){let i=n.getAttribute("data-bundle");b(L("/cpq/bundles"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({lead_product_sfid:i}).toString()}).then(()=>Y(n,i)).catch(f=>console.error("Fetch error:",f))}}function Y(c,n){let i=[...c.querySelectorAll("[data-feature-remove]")],f=[...c.querySelectorAll("[data-feature-option]")],m=c.querySelectorAll("[data-add-option-to-bundle]");T(c),W(H),w(),f.filter(e=>e.dataset.selected).forEach(e=>{let t=e.dataset.selected;c.querySelector(`input[value="${t}"]`).checked=!0,E(e,t)}),m.forEach(e=>{e.addEventListener("click",t=>{let a=t.target.form,r=a.querySelector("[data-single-option-radio-input]:checked");t.preventDefault(),$(a,r.value)})}),i.forEach(e=>{e.addEventListener("click",t=>{let a=t.currentTarget.closest("[data-feature-option]"),r=a.dataset.featureOption,o=a.dataset.selected,d=a.querySelector("[data-loader]");d.classList.add("is-active"),v(o,r,0,!0,()=>{d.classList.remove("is-active"),c.querySelector(`input[value="${o}"]`).checked=!1,E(a,null)})})}),c.querySelectorAll("[data-qty-picker] input").forEach(e=>{e.addEventListener("change",_)}),c.querySelectorAll("[data-variant-option]").forEach(e=>{e.addEventListener("change",C)}),document.querySelectorAll("[data-variant-group] select").forEach(e=>{e.addEventListener("change",C)});function w(){if(document.querySelectorAll("[data-variant-id]").length===0)return;let t=document.querySelector("[data-variant-options-reset-button]"),a=[...document.querySelectorAll("[data-variant-option]")],r=A(a);r.length>0?r.forEach(o=>{q(o,a,r)}):D(a),a.forEach(o=>{o.addEventListener("change",d=>{q(d.target,a),k(a)})}),document.querySelectorAll("[data-variant-group] select").forEach(o=>{o.addEventListener("change",d=>{let s=[...d.target.querySelectorAll("option")].find(l=>l.selected);q(s,a),k(a)})}),t&&t.addEventListener("click",()=>{V(a)}),document.querySelectorAll("[data-variant-selector]").forEach(o=>{o.style.display="block"})}function v(e,t,a,r,o){let d=document.querySelector("[data-bundle-add-to-cart]"),s=U(e,t,a,r);d&&(d.disabled=!0,d.value=d.dataset.loading),b(L(`/cpq/bundles/${n}/product_options/${e}`),{method:"PATCH",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}).then(()=>o()).catch(l=>console.error("Fetch error:",l))}function $(e,t){let a=e.dataset.optional==="true",r=e.id,o=c.querySelector(`[data-feature-option="${r}"]`),d=o.dataset.selected,s=o.querySelector("[data-loader]");s.classList.add("is-active"),a&&d?v(d,r,0,!0,()=>{v(t,r,1,!0,()=>{s.classList.remove("is-active"),E(o,t)})}):v(t,r,1,!0,()=>{s.classList.remove("is-active"),E(o,t)})}function E(e,t){let a=e.querySelector("[data-feature-img]"),r=e.querySelector("[data-feature-headline]"),o=e.querySelector("[data-feature-subheadline]"),d=e.querySelector("[data-feature-remove]"),s=e.querySelector("[data-modal-trigger]"),l={headline:r.dataset.featureHeadline,subheadline:o.dataset.featureSubheadline,imageUrl:a?a.dataset.featureImg:null};if(e.dataset.selected="",t){let p=document.querySelector(`input[value="${t}"]`),u=p.form.querySelector(`[data-single-option="${p.value}"]`),h=p.form.querySelector(`[data-product-option-sfid="${p.dataset.optionId}"]`),y=u.querySelector("[data-single-option-subheading]"),O=h.querySelector("[data-single-option-image]");l={headline:x(h,u),subheadline:y?.innerHTML,imageUrl:O?.src},e.dataset.selected=t,s.querySelector("span").innerText=s.dataset.edit,l.imageUrl?(a.src=l.imageUrl,a.classList.remove("sc-hide")):a.classList.add("sc-hide"),d?.classList.remove("sc-hide"),s.classList.add("sc-hide")}else a.classList.add("sc-hide"),s.querySelector("span").innerText=s.dataset.add,d?.classList.add("sc-hide"),s.classList.remove("sc-hide");r.innerText=l.headline,o.innerHTML=l.subheadline}function x(e,t){return e.querySelector("[data-option-card-subset]")?t.querySelector("[data-single-option-heading]").innerText:e.querySelector("[data-single-option-heading]").innerText}function C(e){let t=e.target.form.id,a=e.target.form.querySelector("[data-feature]").value,r=e.target.getAttribute("data-price"),o=e.target.form.querySelector("[data-bundle-product-option-price]"),d=document.querySelector(`[data-clear-product-option="${t}"]`),s=B(e.target.name,e.target.value,a);d&&(d.checked=!1),b(L(`/cpq/bundles/${n}/product_options/${t}`),{method:"PATCH",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}).then(()=>{o&&(o.innerText=r)}).catch(l=>console.error("Fetch error:",l))}function _(e){let t=e.target.form.id,a=e.target.form.dataset.productOptionSfid,r=e.target.form.querySelector("[data-qty-picker] input").value;a&&v(a,t,r,!1,()=>{})}function H(e){let t=e.currentTarget.closest(".SC-Modal").querySelector("[data-add-option-to-bundle]");t.hasAttribute("disabled")&&t.removeAttribute("disabled")}function U(e,t,a,r){let o=new URLSearchParams({"product_option[sfid]":e,"product_option[quantity]":a,"product_option[feature]":t});return r&&o.append("product_option[single_option]","1"),o.toString()}function B(e,t,a){if(e.startsWith("variant[")){let o=e.replace("variant[","variants][");return new URLSearchParams({[`product_option[${o}[${t}][quantity]`]:"1","product_option[feature]":a}).toString()}let r=new URLSearchParams({[e]:t,"product_option[feature]":a});return e.includes("quantity")||r.append(`${e}[${t}][quantity]`,"1"),r.toString()}function A(e){return e.filter(t=>t.checked||t.selected).sort((t,a)=>t.dataset.type<a.dataset.type?-1:1)}function q(e,t){M(e,t);let a=document.querySelectorAll("[data-variant-id]"),o=[...document.querySelector("[data-lead-product]").querySelectorAll("[data-variant-option]")],d=A(o),s=document.querySelectorAll("[data-variant-group]").length,l=F(d,s),p=document.querySelector("[data-lead-product-image]");a.forEach(u=>{u.dataset.variantId===l?(u.classList.remove("is-hidden"),u.getAttribute("data-variant-image-src")&&p&&(p.src=u.getAttribute("data-variant-image-src"))):u.classList.add("is-hidden")})}function M(e,t){let a=e.dataset.variantAllowedOptions,r=e.dataset.type;!a||a==="{}"||document.querySelectorAll("[data-variant-option]").forEach(o=>{let d=o.dataset.type,s=t.filter(l=>l.dataset.type===d);d!==r&&s.forEach(l=>{l.disabled=!JSON.parse(a)[d].includes(l.value)})})}function F(e,t){if(e.length===t)return e.map(a=>a.value).join(" ")}function D(e){let t=document.querySelector("[data-variant-option-selector]");if(!t)return;let a=t.dataset.masterId,r=JSON.parse(window.sessionStorage.getItem(`${a}:selected-variants`));R(e,r)}function R(e,t){if(!Array.isArray(t))return;t.filter(Boolean).forEach(r=>{let o=document.querySelector(`#${r}`);o&&(o.tagName==="OPTION"?(o.selected=!0,q(o,e)):(o.checked=!0,q(o,e)))})}function k(e){let a=document.querySelector("[data-variant-option-selector]").dataset.masterId,r=A(e).map(o=>o.id);window.sessionStorage.setItem(`${a}:selected-variants`,JSON.stringify(r))}function V(e){e.forEach(t=>{t.tagName==="OPTION"&&(t.selected=!1),t.tagName==="INPUT"&&(t.checked=!1),t.disabled=!1}),document.querySelectorAll("[data-variant-group] select").forEach(t=>{t.querySelectorAll("option[disabled]").forEach(a=>{a.selected=!0})}),j(),G(),J()}function j(){document.querySelectorAll("[data-bundle-add-to-cart]").forEach(e=>{e.disabled="disabled"})}function G(e){document.querySelectorAll("[data-variant-id]").forEach(t=>{let r=!t.dataset.variantId?e===void 0:t.dataset.variantId===e;t.classList.toggle("is-hidden",!r)})}function J(){let t=document.querySelector("[data-variant-option-selector]").dataset.masterId;window.sessionStorage.removeItem(`${t}:selected-variants`)}function W(e){let t,a,r;t=[...document.querySelectorAll("[data-option-card-trigger]")],a=[...document.querySelectorAll("[data-single-option-radio-input]")],a.forEach(s=>{s.addEventListener("change",l=>{let p=l.currentTarget.value,u=document.querySelector(`[data-single-option="${p}"]`),h=[...document.querySelectorAll("[data-qty-picker] input")],y=u.querySelector("[data-qty-picker] input");y&&(h.forEach(O=>O.value=0),y.value=1,v(y.id,y.name+"="+y.value))})}),t.forEach(s=>{s.addEventListener("click",l=>{o(l,e)})});function o(s,l){let p=s.currentTarget.parentNode,u=p.querySelector("[data-option-card-subset]");if(s.preventDefault(),t.forEach(h=>{h.parentNode.classList.remove("is-selected")}),r&&!r.contains(p)&&(r.classList.remove("is-active"),r.parentNode.classList.remove("is-active")),u)u.classList.add("is-active"),u.parentNode.classList.add("is-active"),r=u;else{let h=p.querySelector("input[type=radio]");p.classList.add("is-selected"),h.checked=!0,d(h)}l(s)}function d(s){let l=document.createEvent("HTMLEvents");l.initEvent("change",!1,!0),s.dispatchEvent(l)}}}})();
